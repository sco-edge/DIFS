// Author: Mr. Heesik
// Purpose: For testing client-server communication for his implmentation
// Date: (2026.01.06)

// For internal communication of queries between the master and workers.
// Note that some service names/message names may be the same as public APIs,
// clients are not supposed to directly use them.

syntax = "proto3";

import "infaas_request_status.proto";

// The namepace for internal communications
package infaas.internal;


// Service provided by the workers that the master can talk to.
service Query {
  // Online query, send input data in the payload
  rpc QueryOnline(QueryOnlineRequest) returns (QueryOnlineResponse) {}

  // Offline query, input data are stored on the cloud
  rpc QueryOffline(QueryOfflineRequest) returns (QueryOfflineResponse) {}

  // Heartbeat
  rpc Heartbeat(HeartbeatRequest) returns (HeartbeatResponse) {}
}

message QueryOnlineRequest {
  repeated string Prompt = 1; // Prompt
  int32  Steps = 2;  // timestep
  float  CFG_Scale = 3;  // 7.0 ~ 8.0
  int32  BatchSize = 4; // 동시생성갯수
  int64  Seed = 5;          // 이미지 고유번호
}

message QuerySLO {
  int64 LatencyInUSec = 1;  // Latency in micro-seconds.
  float MinAccuracy = 2;    // Minimum accuracy.
  float MaxCost = 3;        // Maximum cost in dollar.
}

message QueryOnlineResponse {
  // 변경: 생성된 이미지 파일 경로들의 리스트를 반환
  repeated string image_paths = 1; 
  InfaasRequestStatus status = 2;
  }

message QueryOfflineRequest {
  string Prompt = 1; // Prompt
  int32  Steps = 2;  // timestep
  float  CFG_Scale = 3;  // 7.0 ~ 8.0
  int32  BatchSize = 4; // 동시생성갯수
  int64  Seed = 5;          // 이미지 고유번호
}

message QueryOfflineResponse {
  InfaasRequestStatus status = 1;
}

message HeartbeatRequest {
  InfaasRequestStatus status = 1;
}

message HeartbeatResponse {
  InfaasRequestStatus status = 1;
}
