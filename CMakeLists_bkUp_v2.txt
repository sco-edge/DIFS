cmake_minimum_required(VERSION 3.7)
option(ENABLE_TRTIS "Enable Triton/TRTIS support" OFF) # PNB: To turn of TRTIS related support and all related errors for not having it present (2025.11.28)

project(infaas-root)

# PNB: For compilation purposes (2025.11.25)
## INFaaS global include directories (correct!)
include_directories(${CMAKE_SOURCE_DIR}/include)
include_directories(${CMAKE_SOURCE_DIR}/src)

## External dependencies
include_directories(BEFORE /usr/local/include)

## Required library search paths
link_directories(/usr/local/lib /usr/local/lib64)


# Only build worker
option(BUILD_ONLY_WORKER "Only build Worker" OFF)
option(BUILD_ONLY_MD "Only build Metadata Store" OFF)

set(CMAKE_VERBOSE_MAKEFILE ON)
set(CMAKE_COLOR_MAKEFILE   ON)
set(CMAKE_POSITION_INDEPENDENT_CODE ON)

# CMake path
list(APPEND CMAKE_MODULE_PATH ${PROJECT_SOURCE_DIR}/cmake)

# Dependencies
# Find Protobuf installation
# Looks for protobuf-config.cmake file installed by Protobuf's cmake installation.
set(protobuf_MODULE_COMPATIBLE TRUE)
find_package(Protobuf REQUIRED)

# Find gRPC installation
# Looks for gRPCConfig.cmake file installed by gRPC's cmake installation.
# find_package(gRPC REQUIRED)

set(_GRPC_GRPCPP_UNSECURE grpc++_unsecure)


# set(_GRPC_CPP_PLUGIN_EXECUTABLE /usr/local/bin/grpc_cpp_plugin) # PNB: Commented out by me in favor of the line below (2025.11.25)
# PNB: For compilation purposes (2025.11.25)
find_program(_GRPC_CPP_PLUGIN_EXECUTABLE grpc_cpp_plugin)

if(NOT _GRPC_CPP_PLUGIN_EXECUTABLE)
    message(FATAL_ERROR "grpc_cpp_plugin not found. Install grpc-tools or add it to PATH.")
endif()


set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++11")

set(CMAKE_PREFIX_PATH "/usr/local")
find_package(gRPC REQUIRED)

# Targets
add_subdirectory(protos)
add_subdirectory(src)

